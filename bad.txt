diff --git a/lib/jobs.dart b/lib/jobs.dart
index 61857e5..322ceca 100644
--- a/lib/jobs.dart
+++ b/lib/jobs.dart
@@ -4,56 +4,6 @@ import 'package:files3/utils/path_utils.dart' as p;
 import 'package:files3/utils/job.dart';
 import 'package:files3/models.dart';
 
-class ActiveJobs extends StatefulWidget {
-  final List<Job> jobs;
-  final Function() onUpdate;
-
-  const ActiveJobs({super.key, required this.jobs, required this.onUpdate});
-
-  @override
-  ActiveJobsState createState() => ActiveJobsState();
-}
-
-class ActiveJobsState extends State<ActiveJobs> {
-  @override
-  Widget build(BuildContext context) {
-    return SliverList.builder(
-      itemCount: widget.jobs.length,
-      itemBuilder: (context, index) {
-        final job = widget.jobs[index];
-        return JobView(job: job, onUpdate: widget.onUpdate);
-      },
-    );
-  }
-}
-
-class CompletedJobs extends StatefulWidget {
-  final List<Job> completedJobs;
-  final Function() onUpdate;
-
-  const CompletedJobs({
-    super.key,
-    required this.completedJobs,
-    required this.onUpdate,
-  });
-
-  @override
-  CompletedJobsState createState() => CompletedJobsState();
-}
-
-class CompletedJobsState extends State<CompletedJobs> {
-  @override
-  Widget build(BuildContext context) {
-    return SliverList.builder(
-      itemCount: widget.completedJobs.length,
-      itemBuilder: (context, index) {
-        final job = widget.completedJobs[index];
-        return JobView(job: job, onUpdate: widget.onUpdate);
-      },
-    );
-  }
-}
-
 class JobView extends StatefulWidget {
   final Job job;
   final RemoteFile? relativeTo;
diff --git a/lib/list_files.dart b/lib/list_files.dart
index a355e50..ab7ab1e 100644
--- a/lib/list_files.dart
+++ b/lib/list_files.dart
@@ -95,7 +95,7 @@ class MyGridTile extends StatelessWidget {
   }
 }
 
-class ListFiles extends StatelessWidget {
+class ListFiles extends StatefulWidget {
   final List<dynamic> files;
   final Map<String, GlobalKey> keys;
   final SortMode sortMode;
@@ -113,9 +113,8 @@ class ListFiles extends StatelessWidget {
   final int Function(RemoteFile) dirSize;
   final String Function(RemoteFile) dirModified;
   final String? Function(RemoteFile, int?) getLink;
-  List<GalleryProps>? _galleryFiles;
 
-  ListFiles({
+  const ListFiles({
     super.key,
     required this.files,
     required this.keys,
@@ -136,60 +135,28 @@ class ListFiles extends StatelessWidget {
     required this.getLink,
   });
 
+  @override
+  State<StatefulWidget> createState() => ListFilesState();
+}
+
+class ListFilesState extends State<ListFiles> {
+  List<FileProps> _sortedFiles = [];
+  List<GalleryProps>? _galleryFiles;
+
   Future<void> Function() galleryBuilder(BuildContext context, FileProps item) {
     return () async {
-      _galleryFiles ??= files
-          .where((f) {
-            return !p.isDir(f.key);
-          })
-          .map((f) {
-            String url =
-                getLink(
-                  f is Job
-                      ? RemoteFile(
-                          key: f.remoteKey,
-                          size: f.bytes,
-                          etag: f.md5.toString(),
-                        )
-                      : f,
-                  null,
-                ) ??
-                '';
-            return GalleryProps(
-              file: f is Job
-                  ? RemoteFile(
-                      key: f.remoteKey,
-                      size: f.bytes,
-                      etag: f.md5.toString(),
-                    )
-                  : f,
-              title: p.isWithin(relativeto.key, f.key)
-                  ? p.s3(p.relative(f.key, from: relativeto.key))
-                  : f.key,
-              url: url,
-              path: File(Main.pathFromKey(f.key) ?? f.key).existsSync()
-                  ? (Main.pathFromKey(f.key) ?? f.key)
-                  : Main.cachePathFromKey(f.key),
-            );
-          })
-          .toList();
-      Navigator.of(context).push(
+      Navigator.of(context, rootNavigator: true).push(
         PageRouteBuilder<int>(
-          pageBuilder: (_, __, ___) {
-            return HeroControllerScope(
-              controller: MaterialApp.createMaterialHeroController(),
-              child: Gallery(
-                keys: keys,
-                files: _galleryFiles!,
-                initialIndex: _galleryFiles!.indexWhere(
-                  (f) => f.file.key == item.key,
-                ),
-                buildContextMenu: (file) {
-                  return buildContextMenu(context, file);
-                },
-              ),
-            );
-          },
+          pageBuilder: (_, _, _) => Gallery(
+            keys: widget.keys,
+            files: _galleryFiles!,
+            initialIndex: _galleryFiles!.indexWhere(
+              (f) => f.file.key == item.key,
+            ),
+            buildContextMenu: (file) {
+              return widget.buildContextMenu(context, file);
+            },
+          ),
         ),
       );
     };
@@ -214,8 +181,10 @@ class ListFiles extends StatelessWidget {
                   height: 24,
                   width: 24,
                   mediaProvider: MyUrlMediaProvider(
-                    p.isWithin(relativeto.key, item.key)
-                        ? p.s3(p.relative(item.key, from: relativeto.key))
+                    p.isWithin(widget.relativeto.key, item.key)
+                        ? p.s3(
+                            p.relative(item.key, from: widget.relativeto.key),
+                          )
                         : item.file!.key,
                     getMediaType(item.key)!,
                     item.url!,
@@ -235,14 +204,18 @@ class ListFiles extends StatelessWidget {
 
   Widget listItemBuilder(BuildContext context, FileProps item) {
     return item.job != null
-        ? JobView(job: item.job!, relativeTo: relativeto, onUpdate: onUpdate)
+        ? JobView(
+            job: item.job!,
+            relativeTo: widget.relativeto,
+            onUpdate: widget.onUpdate,
+          )
         : p.isDir(item.key)
         ? ListTile(
             dense: MediaQuery.of(context).size.width < 600 ? true : false,
             visualDensity: MediaQuery.of(context).size.width < 600
                 ? VisualDensity.compact
                 : VisualDensity.standard,
-            selected: selection.any((selected) {
+            selected: widget.selection.any((selected) {
               return selected.key == item.key;
             }),
             selectedTileColor: Theme.of(
@@ -255,8 +228,12 @@ class ListFiles extends StatelessWidget {
                   : Icons.cloud_circle_rounded,
             ),
             title: Text(
-              p.isWithin(relativeto.key, item.key)
-                  ? p.s3(p.asDir(p.relative(item.key, from: relativeto.key)))
+              p.isWithin(widget.relativeto.key, item.key)
+                  ? p.s3(
+                      p.asDir(
+                        p.relative(item.key, from: widget.relativeto.key),
+                      ),
+                    )
                   : item.key,
             ),
             subtitle: Column(
@@ -266,12 +243,12 @@ class ListFiles extends StatelessWidget {
                   scrollDirection: Axis.horizontal,
                   child: Row(
                     children: [
-                      Text(dirModified(item.file!)),
+                      Text(widget.dirModified(item.file!)),
                       SizedBox(width: 8),
-                      Text(bytesToReadable(dirSize(item.file!))),
+                      Text(bytesToReadable(widget.dirSize(item.file!))),
                       SizedBox(width: 8),
                       Text(() {
-                        final count = this.count(item.file!, recursive: true);
+                        final count = widget.count(item.file!, recursive: true);
                         if (count.$1 == 0) {
                           return '${count.$2} files';
                         }
@@ -286,7 +263,7 @@ class ListFiles extends StatelessWidget {
                 if (p.s3(p.dirname(item.file!.key)).isEmpty)
                   Row(
                     children: [
-                      Text('${Main.backupMode(item.file!.key).name}:'),
+                      Text('${Main.backupModeFromKey(item.file!.key).name}:'),
                       SizedBox(width: 4),
                       SingleChildScrollView(
                         scrollDirection: Axis.horizontal,
@@ -299,125 +276,117 @@ class ListFiles extends StatelessWidget {
               ],
             ),
             onTap:
-                selection.isNotEmpty && selectionAction == SelectionAction.none
+                widget.selection.isNotEmpty &&
+                    widget.selectionAction == SelectionAction.none
                 ? () {
-                    select(item.file!);
+                    widget.select(item.file!);
                   }
-                : selection.any(
+                : widget.selection.any(
                     (s) => p.isWithin(s.key, item.key) || s.key == item.key,
                   )
                 ? null
-                : changeDirectory(item.file!),
-            onLongPress: selectionAction == SelectionAction.none
+                : widget.changeDirectory(item.file!),
+            onLongPress: widget.selectionAction == SelectionAction.none
                 ? () {
-                    select(item.file!);
+                    widget.select(item.file!);
                   }
                 : null,
-            trailing: selection.isNotEmpty
-                ? selection.any((selected) {
+            trailing: widget.selection.isNotEmpty
+                ? widget.selection.any((selected) {
                         return selected.key == item.key;
                       })
                       ? Icon(Icons.check_circle)
-                      : selectionAction == SelectionAction.none
+                      : widget.selectionAction == SelectionAction.none
                       ? Icon(Icons.circle_outlined)
                       : null
                 : IconButton(
                     onPressed: () async {
-                      showContextMenu(item.file!);
+                      widget.showContextMenu(item.file!);
                     },
                     icon: Icon(Icons.more_vert),
                   ),
           )
-        : Material(
-            child: InkWell(
-              onTap: galleryBuilder(context, item),
-              child: ListTile(
-                dense: MediaQuery.of(context).size.width < 600 ? true : false,
-                visualDensity: MediaQuery.of(context).size.width < 600
-                    ? VisualDensity.compact
-                    : VisualDensity.standard,
-                selected: selection.any((selected) {
-                  return selected.key == item.key;
-                }),
-                selectedTileColor: Theme.of(
-                  context,
-                ).colorScheme.primary.withValues(alpha: 0.1),
-                selectedColor: Theme.of(context).colorScheme.primary,
-                leading: GestureDetector(
-                  onTap: galleryBuilder(context, item),
-                  child: Hero(tag: item.key, child: preview(item)),
-                ),
-                title: SingleChildScrollView(
-                  scrollDirection: Axis.horizontal,
-                  child: Text(
-                    p.isWithin(relativeto.key, item.key)
-                        ? p.s3(p.relative(item.key, from: relativeto.key))
-                        : item.file!.key,
-                  ),
-                ),
-                subtitle: SingleChildScrollView(
-                  scrollDirection: Axis.horizontal,
-                  child: Row(
-                    children: [
-                      Text(timeToReadable(item.file!.lastModified!)),
-                      SizedBox(width: 8),
-                      Text(bytesToReadable(item.size)),
-                      SizedBox(width: 8),
-                      FutureBuilder(
-                        future: File(
-                          Main.pathFromKey(item.key) ?? item.key,
-                        ).exists(),
-                        builder: (context, snapshot) {
-                          if (snapshot.connectionState ==
-                              ConnectionState.waiting) {
-                            return Icon(Icons.hourglass_empty, size: 16);
-                          }
-                          if (snapshot.hasData && snapshot.data == true) {
-                            return Icon(Icons.download_done, size: 16);
-                          } else {
-                            return Icon(
-                              Icons.cloud_download,
-                              color: Theme.of(context).colorScheme.primary,
-                              size: 16,
-                            );
-                          }
-                        },
-                      ),
-                      SizedBox(width: 8),
-                      Text(p.extension(item.key)),
-                    ],
-                  ),
-                ),
-                trailing: selection.isNotEmpty
-                    ? selection.any((selected) {
-                            return selected.key == item.key;
-                          })
-                          ? Icon(Icons.check_circle)
-                          : selectionAction == SelectionAction.none
-                          ? Icon(Icons.circle_outlined)
-                          : null
-                    : IconButton(
-                        onPressed: () async {
-                          showContextMenu(item.file!);
-                        },
-                        icon: Icon(Icons.more_vert),
-                      ),
-                onTap:
-                    selection.isNotEmpty &&
-                        selectionAction == SelectionAction.none
-                    ? () {
-                        select(item.file!);
+        : ListTile(
+            dense: MediaQuery.of(context).size.width < 600 ? true : false,
+            visualDensity: MediaQuery.of(context).size.width < 600
+                ? VisualDensity.compact
+                : VisualDensity.standard,
+            selected: widget.selection.any((selected) {
+              return selected.key == item.key;
+            }),
+            selectedTileColor: Theme.of(
+              context,
+            ).colorScheme.primary.withValues(alpha: 0.1),
+            selectedColor: Theme.of(context).colorScheme.primary,
+            leading: Hero(tag: item.key, child: preview(item)),
+            title: SingleChildScrollView(
+              scrollDirection: Axis.horizontal,
+              child: Text(
+                p.isWithin(widget.relativeto.key, item.key)
+                    ? p.s3(p.relative(item.key, from: widget.relativeto.key))
+                    : item.file!.key,
+              ),
+            ),
+            subtitle: SingleChildScrollView(
+              scrollDirection: Axis.horizontal,
+              child: Row(
+                children: [
+                  Text(timeToReadable(item.file!.lastModified!)),
+                  SizedBox(width: 8),
+                  Text(bytesToReadable(item.size)),
+                  SizedBox(width: 8),
+                  FutureBuilder(
+                    future: File(
+                      Main.pathFromKey(item.key) ?? item.key,
+                    ).exists(),
+                    builder: (context, snapshot) {
+                      if (snapshot.connectionState == ConnectionState.waiting) {
+                        return Icon(Icons.hourglass_empty, size: 16);
                       }
-                    : selectionAction != SelectionAction.none
-                    ? null
-                    : galleryBuilder(context, item),
-                onLongPress: selectionAction == SelectionAction.none
-                    ? () {
-                        select(item.file!);
+                      if (snapshot.hasData && snapshot.data == true) {
+                        return Icon(Icons.download_done, size: 16);
+                      } else {
+                        return Icon(
+                          Icons.cloud_download,
+                          color: Theme.of(context).colorScheme.primary,
+                          size: 16,
+                        );
                       }
-                    : null,
+                    },
+                  ),
+                  SizedBox(width: 8),
+                  Text(p.extension(item.key)),
+                ],
               ),
             ),
+            trailing: widget.selection.isNotEmpty
+                ? widget.selection.any((selected) {
+                        return selected.key == item.key;
+                      })
+                      ? Icon(Icons.check_circle)
+                      : widget.selectionAction == SelectionAction.none
+                      ? Icon(Icons.circle_outlined)
+                      : null
+                : IconButton(
+                    onPressed: () async {
+                      widget.showContextMenu(item.file!);
+                    },
+                    icon: Icon(Icons.more_vert),
+                  ),
+            onTap:
+                widget.selection.isNotEmpty &&
+                    widget.selectionAction == SelectionAction.none
+                ? () {
+                    widget.select(item.file!);
+                  }
+                : widget.selectionAction != SelectionAction.none
+                ? null
+                : galleryBuilder(context, item),
+            onLongPress: widget.selectionAction == SelectionAction.none
+                ? () {
+                    widget.select(item.file!);
+                  }
+                : null,
           );
   }
 
@@ -426,7 +395,7 @@ class ListFiles extends StatelessWidget {
         ? SizedBox(height: 100, width: 100)
         : p.isDir(item.key)
         ? MyGridTile(
-            selected: selection.any((selected) {
+            selected: widget.selection.any((selected) {
               return selected.key == item.key;
             }),
             footer: Column(
@@ -434,9 +403,11 @@ class ListFiles extends StatelessWidget {
                 SingleChildScrollView(
                   scrollDirection: Axis.horizontal,
                   child: Text(
-                    p.isWithin(relativeto.key, item.key)
+                    p.isWithin(widget.relativeto.key, item.key)
                         ? p.s3(
-                            p.asDir(p.relative(item.key, from: relativeto.key)),
+                            p.asDir(
+                              p.relative(item.key, from: widget.relativeto.key),
+                            ),
                           )
                         : item.key,
                   ),
@@ -444,24 +415,25 @@ class ListFiles extends StatelessWidget {
               ],
             ),
             onTap:
-                selection.isNotEmpty && selectionAction == SelectionAction.none
+                widget.selection.isNotEmpty &&
+                    widget.selectionAction == SelectionAction.none
                 ? null
-                : selection.any(
+                : widget.selection.any(
                     (s) => p.isWithin(s.key, item.key) || s.key == item.key,
                   )
                 ? null
-                : changeDirectory(item.file!),
-            onLongPress: selectionAction == SelectionAction.none
+                : widget.changeDirectory(item.file!),
+            onLongPress: widget.selectionAction == SelectionAction.none
                 ? () {
-                    select(item.file!);
+                    widget.select(item.file!);
                   }
                 : null,
-            topRightBadge: selection.isNotEmpty
-                ? selectionAction == SelectionAction.none
+            topRightBadge: widget.selection.isNotEmpty
+                ? widget.selectionAction == SelectionAction.none
                       ? IconButton(
                           icon: Icon(
-                            selection.isEmpty ||
-                                    selection.any((selected) {
+                            widget.selection.isEmpty ||
+                                    widget.selection.any((selected) {
                                       return selected.key == item.key;
                                     })
                                 ? Icons.check_circle
@@ -469,10 +441,10 @@ class ListFiles extends StatelessWidget {
                             color: Theme.of(context).colorScheme.primary,
                           ),
                           onPressed: () {
-                            select(item.file!);
+                            widget.select(item.file!);
                           },
                         )
-                      : selection.any((selected) {
+                      : widget.selection.any((selected) {
                           return selected.key == item.key;
                         })
                       ? IconButton(
@@ -484,7 +456,7 @@ class ListFiles extends StatelessWidget {
                       : null
                 : IconButton(
                     onPressed: () async {
-                      showContextMenu(item.file!);
+                      widget.showContextMenu(item.file!);
                     },
                     icon: Icon(Icons.more_vert),
                   ),
@@ -495,7 +467,7 @@ class ListFiles extends StatelessWidget {
             ),
           )
         : MyGridTile(
-            selected: selection.any((selected) {
+            selected: widget.selection.any((selected) {
               return selected.key == item.key;
             }),
             footer: Column(
@@ -503,8 +475,10 @@ class ListFiles extends StatelessWidget {
                 SingleChildScrollView(
                   scrollDirection: Axis.horizontal,
                   child: Text(
-                    p.isWithin(relativeto.key, item.key)
-                        ? p.s3(p.relative(item.key, from: relativeto.key))
+                    p.isWithin(widget.relativeto.key, item.key)
+                        ? p.s3(
+                            p.relative(item.key, from: widget.relativeto.key),
+                          )
                         : item.file!.key,
                   ),
                 ),
@@ -530,12 +504,12 @@ class ListFiles extends StatelessWidget {
                 },
               ),
             ),
-            topRightBadge: selection.isNotEmpty
-                ? selectionAction == SelectionAction.none
+            topRightBadge: widget.selection.isNotEmpty
+                ? widget.selectionAction == SelectionAction.none
                       ? IconButton(
                           icon: Icon(
-                            selection.isEmpty ||
-                                    selection.any((selected) {
+                            widget.selection.isEmpty ||
+                                    widget.selection.any((selected) {
                                       return selected.key == item.key;
                                     })
                                 ? Icons.check_circle
@@ -543,10 +517,10 @@ class ListFiles extends StatelessWidget {
                             color: Theme.of(context).colorScheme.primary,
                           ),
                           onPressed: () {
-                            select(item.file!);
+                            widget.select(item.file!);
                           },
                         )
-                      : selection.any((selected) {
+                      : widget.selection.any((selected) {
                           return selected.key == item.key;
                         })
                       ? IconButton(
@@ -558,77 +532,99 @@ class ListFiles extends StatelessWidget {
                       : null
                 : IconButton(
                     onPressed: () async {
-                      showContextMenu(item.file!);
+                      widget.showContextMenu(item.file!);
                     },
                     icon: Icon(Icons.more_vert),
                   ),
-            onLongPress: selectionAction == SelectionAction.none
+            onLongPress: widget.selectionAction == SelectionAction.none
                 ? () {
-                    select(item.file!);
+                    widget.select(item.file!);
                   }
                 : null,
-            child: Material(
-              child: InkWell(
-                onTap: galleryBuilder(context, item),
-                child: Hero(tag: item.key, child: preview(item)),
-              ),
+            child: GestureDetector(
+              onTap: galleryBuilder(context, item),
+              child: Hero(tag: item.key, child: preview(item)),
             ),
           );
   }
 
+  @override
+  void didUpdateWidget(covariant ListFiles oldWidget) {
+    super.didUpdateWidget(oldWidget);
+    if (oldWidget.files != widget.files) {
+      _sortedFiles = sort(
+        widget.files.map((file) {
+          String url =
+              widget.getLink(
+                file is Job
+                    ? RemoteFile(
+                        key: file.remoteKey,
+                        size: file.bytes,
+                        etag: file.md5.toString(),
+                      )
+                    : file,
+                null,
+              ) ??
+              '';
+          return file is Job
+              ? FileProps(
+                  key: file.remoteKey,
+                  size: file.bytes,
+                  job: file,
+                  url: url,
+                )
+              : p.isDir(file.key)
+              ? FileProps(key: file.key, size: file.size, file: file, url: url)
+              : FileProps(key: file.key, size: file.size, file: file, url: url);
+        }),
+        widget.sortMode,
+        widget.foldersFirst,
+      );
+      _galleryFiles = _sortedFiles
+          .where((f) {
+            return !p.isDir(f.key);
+          })
+          .map(
+            (f) => GalleryProps(
+              file:
+                  f.file ??
+                  RemoteFile(
+                    key: f.key,
+                    size: f.size,
+                    etag: f.job!.md5.toString(),
+                  ),
+              title: p.isWithin(widget.relativeto.key, f.key)
+                  ? p.s3(p.relative(f.key, from: widget.relativeto.key))
+                  : f.key,
+              url: f.url!,
+              path: File(Main.pathFromKey(f.key) ?? f.key).existsSync()
+                  ? (Main.pathFromKey(f.key) ?? f.key)
+                  : Main.cachePathFromKey(f.key),
+            ),
+          )
+          .toList();
+    }
+  }
+
   @override
   Widget build(BuildContext context) {
-    final sortedFiles = sort(
-      files.map((file) {
-        String url =
-            getLink(
-              file is Job
-                  ? RemoteFile(
-                      key: file.remoteKey,
-                      size: file.bytes,
-                      etag: file.md5.toString(),
-                    )
-                  : file,
-              null,
-            ) ??
-            '';
-        return file is Job
-            ? FileProps(
-                key: file.remoteKey,
-                size: file.bytes,
-                job: file,
-                url: url,
-              )
-            : p.isDir(file.key)
-            ? FileProps(key: file.key, size: file.size, file: file, url: url)
-            : FileProps(key: file.key, size: file.size, file: file, url: url);
-      }),
-      sortMode,
-      foldersFirst,
-    );
-    return gridView
+    return widget.gridView
         ? SliverGrid.builder(
             gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
               crossAxisCount: MediaQuery.of(context).size.width < 600 ? 4 : 6,
               childAspectRatio: 3 / 4,
             ),
-            itemCount: sortedFiles.length,
+            itemCount: _sortedFiles.length,
             itemBuilder: (context, index) {
-              keys[sortedFiles[index].key] ??= GlobalKey();
-              return Material(
-                key: keys[sortedFiles[index].key],
-                child: gridItemBuilder(context, sortedFiles[index]),
-              );
+              widget.keys[_sortedFiles[index].key] ??= GlobalKey();
+              return gridItemBuilder(context, _sortedFiles[index]);
             },
           )
         : SliverList.builder(
-            itemCount: sortedFiles.length,
+            itemCount: _sortedFiles.length,
             itemBuilder: (context, index) {
-              keys[sortedFiles[index].key] ??= GlobalKey();
-              return Material(
-                key: keys[sortedFiles[index].key],
-                child: listItemBuilder(context, sortedFiles[index]),
-              );
+              widget.keys[_sortedFiles[index].key] ??= GlobalKey();
+              return listItemBuilder(context, _sortedFiles[index]);
             },
           );
   }
diff --git a/lib/main.dart b/lib/main.dart
index 8dd0532..4589ce3 100644
--- a/lib/main.dart
+++ b/lib/main.dart
@@ -19,7 +19,6 @@ import 'package:files3/settings.dart';
 import 'package:files3/globals.dart';
 import 'package:files3/helpers.dart';
 import 'package:files3/models.dart';
-import 'package:files3/jobs.dart';
 
 /// ===============================
 /// SHARED ASYNC JOB
@@ -392,7 +391,7 @@ class _HomeState extends State<Home> {
     });
     try {
       await Main.profileFromKey(dir)!.fileManager!.createDirectory(dir);
-      Main.remoteFiles.add(
+      Main.remoteFilesAdd(
         RemoteFile(
           key: p.asDir(dir),
           size: 0,
@@ -459,7 +458,7 @@ class _HomeState extends State<Home> {
       ).copySync(Main.pathFromKey(newKey) ?? newKey);
     }
 
-    Main.remoteFiles.add(newFile);
+    Main.remoteFilesAdd(newFile);
     if (refresh) {
       setState(() {
         _loading.value = false;
@@ -506,10 +505,10 @@ class _HomeState extends State<Home> {
   void _deleteLocal(String key) {
     if (p.isDir(key)) {
       if (Directory(Main.pathFromKey(key) ?? key).existsSync()) {
-        if (Main.backupMode(key) != BackupMode.upload) {
+        if (Main.backupModeFromKey(key) != BackupMode.upload) {
           _setBackupMode(
             key,
-            Main.backupMode(p.s3(p.dirname(key))) == BackupMode.upload
+            Main.backupModeFromKey(p.s3(p.dirname(key))) == BackupMode.upload
                 ? null
                 : BackupMode.upload,
           );
@@ -518,10 +517,10 @@ class _HomeState extends State<Home> {
       }
     } else {
       if (File(Main.pathFromKey(key) ?? key).existsSync()) {
-        if (Main.backupMode(key) != BackupMode.upload) {
+        if (Main.backupModeFromKey(key) != BackupMode.upload) {
           _setBackupMode(
             key,
-            Main.backupMode(p.s3(p.dirname(key))) == BackupMode.upload
+            Main.backupModeFromKey(p.s3(p.dirname(key))) == BackupMode.upload
                 ? null
                 : BackupMode.upload,
           );
@@ -572,7 +571,7 @@ class _HomeState extends State<Home> {
         }
       }
 
-      Main.remoteFiles.removeWhere((file) => keysForProfile.contains(file.key));
+      Main.remoteFilesRemoveWhere((file) => keysForProfile.contains(file.key));
     }
 
     if (refresh) {
@@ -626,7 +625,7 @@ class _HomeState extends State<Home> {
         await profile.fileManager?.deleteFile(file.key);
       }
 
-      Main.remoteFiles.removeWhere(
+      Main.remoteFilesRemoveWhere(
         (file) =>
             filesForProfile.map((e) => e.key).contains(file.key) &&
             !p.isDir(file.key),
@@ -648,7 +647,7 @@ class _HomeState extends State<Home> {
         await profile.fileManager?.deleteFile(dir.key);
       }
 
-      Main.remoteFiles.removeWhere(
+      Main.remoteFilesRemoveWhere(
         (file) => dirsForProfile.map((e) => e.key).contains(file.key),
       );
 
@@ -752,12 +751,12 @@ class _HomeState extends State<Home> {
 
   void _downloadFile(RemoteFile file, {String? localPath}) {
     if (!File(Main.pathFromKey(file.key) ?? file.key).existsSync()) {
-      if (Main.backupMode(file.key) != BackupMode.sync &&
+      if (Main.backupModeFromKey(file.key) != BackupMode.sync &&
           (localPath ?? Main.pathFromKey(file.key)) ==
               Main.pathFromKey(file.key)) {
         _setBackupMode(
           file.key,
-          Main.backupMode(p.s3(p.dirname(file.key))) == BackupMode.sync
+          Main.backupModeFromKey(p.s3(p.dirname(file.key))) == BackupMode.sync
               ? null
               : BackupMode.sync,
         );
@@ -767,11 +766,11 @@ class _HomeState extends State<Home> {
   }
 
   void _downloadDirectory(RemoteFile dir, {String? localPath}) {
-    if (Main.backupMode(dir.key) != BackupMode.sync &&
+    if (Main.backupModeFromKey(dir.key) != BackupMode.sync &&
         (localPath ?? Main.pathFromKey(dir.key)) == Main.pathFromKey(dir.key)) {
       _setBackupMode(
         dir.key,
-        Main.backupMode(p.s3(p.dirname(dir.key))) == BackupMode.sync
+        Main.backupModeFromKey(p.s3(p.dirname(dir.key))) == BackupMode.sync
             ? null
             : BackupMode.sync,
       );
@@ -953,6 +952,48 @@ class _HomeState extends State<Home> {
     }
   }
 
+  List<dynamic> _getCurrentItems() {
+    final items = _searching && _navIndex == 0
+        ? _searchResults
+        : _driveDir.key == '' && _navIndex == 0
+        ? Set<RemoteFile>.from(
+            Main.remoteFiles
+                .where(
+                  (file) =>
+                      p.s3(p.dirname(file.key)).isEmpty && p.isDir(file.key),
+                )
+                .map<RemoteFile>((file) => file),
+          ).toList()
+        : _driveDir.key != '' && _navIndex == 0
+        ? [
+            ...Main.remoteFiles.where(
+              (file) =>
+                  p.s3(p.dirname(file.key)) == p.s3(_driveDir.key) &&
+                  !Main.ignoreKeyRegexps.any(
+                    (regexp) => RegExp(regexp).hasMatch(file.key),
+                  ) &&
+                  !Job.jobs.any(
+                    (job) =>
+                        job.remoteKey == file.key &&
+                        job.status != JobStatus.completed,
+                  ),
+            ),
+            ...Job.jobs.where(
+              (job) =>
+                  p.s3(p.dirname(job.remoteKey)) == p.s3(_driveDir.key) &&
+                  job.status != JobStatus.completed,
+            ),
+          ]
+        : _navIndex == 1
+        ? Job.jobs.where((job) => job.status == JobStatus.completed).toList()
+        : _navIndex == 2
+        ? Job.jobs.where((job) => job.status != JobStatus.completed).toList()
+        : [];
+
+    _updateAllSelectableItems(items.whereType<RemoteFile>().toList());
+    return items;
+  }
+
   Future<void> _search() async {
     setState(() {
       _loading.value = true;
@@ -1143,6 +1184,10 @@ class _HomeState extends State<Home> {
       }
     }
 
+    setState(() {
+      _loading.value = true;
+    });
+
     await Main.init();
 
     final uiConfig = ConfigManager.loadUiConfig();
@@ -1150,10 +1195,6 @@ class _HomeState extends State<Home> {
     ultraDarkController.update(uiConfig.ultraDark);
     _changeDirectory(RemoteFile(key: '', size: 0, etag: ''))?.call();
 
-    setState(() {
-      _loading.value = true;
-    });
-
     Main.setLoadingState = (bool loading) {
       setState(() {
         _loading.value = loading;
@@ -1162,6 +1203,10 @@ class _HomeState extends State<Home> {
     Main.setHomeState = () {
       setState(() {});
     };
+    Main.onRemoteFilesChanged = () {
+      _updateCounts();
+      setState(() {});
+    };
 
     setState(() {
       _loading.value = false;
@@ -1196,11 +1241,7 @@ class _HomeState extends State<Home> {
   @override
   void setState(void Function() fn) async {
     if (mounted) {
-      super.setState(() {
-        Main.ensureDirectoryObjects();
-        fn();
-        _updateCounts();
-      });
+      super.setState(fn);
     }
     if (!(_profile?.accessible ?? false) &&
         !(_inaccessibleTimer?.isActive ?? false)) {
@@ -1889,7 +1930,7 @@ class _HomeState extends State<Home> {
                                     Row(
                                       children: [
                                         Text(
-                                          '${Main.backupMode(_driveDir.key).name}: ',
+                                          '${Main.backupModeFromKey(_driveDir.key).name}: ',
                                           style: Theme.of(
                                             context,
                                           ).textTheme.labelSmall,
@@ -1957,147 +1998,33 @@ class _HomeState extends State<Home> {
                     )
                   : null,
             ),
-            _searching && _navIndex == 0
-                ? ListFiles(
-                    files: () {
-                      _updateAllSelectableItems(
-                        _searchResults.whereType<RemoteFile>().toList(),
-                      );
-                      return _searchResults;
-                    }(),
-                    keys: _keys,
-                    sortMode: _listOptions.sortMode,
-                    foldersFirst: _listOptions.foldersFirst,
-                    gridView: _listOptions.viewMode == ViewMode.grid,
-                    relativeto: _driveDir,
-                    selection: _selection,
-                    selectionAction: _selectionAction,
-                    onUpdate: () {
-                      setState(() {});
-                    },
-                    changeDirectory: _changeDirectory,
-                    select: _select,
-                    showContextMenu: (file) async {
-                      await Main.stopWatchers();
-                      await _showContextMenu(file);
-                    },
-                    buildContextMenu: _buildContextMenu,
-                    count: _count,
-                    dirSize: _dirSize,
-                    dirModified: _dirModified,
-                    getLink: _getLink,
-                  )
-                : _driveDir.key == '' && _navIndex == 0
-                ? ListFiles(
-                    files: () {
-                      final files = Set<RemoteFile>.from(
-                        Main.remoteFiles
-                            .where(
-                              (file) =>
-                                  p.s3(p.dirname(file.key)).isEmpty &&
-                                  p.isDir(file.key),
-                            )
-                            .map<RemoteFile>((file) => file),
-                      ).toList();
-                      _updateAllSelectableItems(
-                        files.whereType<RemoteFile>().toList(),
-                      );
-                      return files;
-                    }(),
-                    keys: _keys,
-                    sortMode: _listOptions.sortMode,
-                    foldersFirst: _listOptions.foldersFirst,
-                    gridView: _listOptions.viewMode == ViewMode.grid,
-                    relativeto: _driveDir,
-                    selection: _selection,
-                    selectionAction: _selectionAction,
-                    onUpdate: () {
-                      setState(() {});
-                    },
-                    changeDirectory: _changeDirectory,
-                    select: _select,
-                    showContextMenu: (file) async {
-                      await Main.stopWatchers();
-                      await _showContextMenu(file);
-                    },
-                    buildContextMenu: _buildContextMenu,
-                    count: _count,
-                    dirSize: _dirSize,
-                    dirModified: _dirModified,
-                    getLink: _getLink,
-                  )
-                : _driveDir.key != '' && _navIndex == 0
-                ? ListFiles(
-                    files: () {
-                      final files = [
-                        ...Main.remoteFiles.where(
-                          (file) =>
-                              p.s3(p.dirname(file.key)) ==
-                                  p.s3(_driveDir.key) &&
-                              !Main.ignoreKeyRegexps.any(
-                                (regexp) => RegExp(regexp).hasMatch(file.key),
-                              ) &&
-                              !Job.jobs.any(
-                                (job) =>
-                                    job.remoteKey == file.key &&
-                                    job.status != JobStatus.completed,
-                              ),
-                        ),
-                        ...Job.jobs.where(
-                          (job) =>
-                              p.s3(p.dirname(job.remoteKey)) ==
-                                  p.s3(_driveDir.key) &&
-                              job.status != JobStatus.completed,
-                        ),
-                      ];
-                      _updateAllSelectableItems(
-                        files.whereType<RemoteFile>().toList(),
-                      );
-                      return files;
-                    }(),
-                    keys: _keys,
-                    sortMode: _listOptions.sortMode,
-                    foldersFirst: _listOptions.foldersFirst,
-                    gridView: _listOptions.viewMode == ViewMode.grid,
-                    relativeto: _driveDir,
-                    selection: _selection,
-                    selectionAction: _selectionAction,
-                    onUpdate: () {
-                      setState(() {});
-                    },
-                    changeDirectory: _changeDirectory,
-                    select: _select,
-                    showContextMenu: (file) async {
-                      await Main.stopWatchers();
-                      await _showContextMenu(file);
-                    },
-                    buildContextMenu: _buildContextMenu,
-                    count: _count,
-                    dirSize: _dirSize,
-                    dirModified: _dirModified,
-                    getLink: _getLink,
-                  )
-                : _navIndex == 1
-                ? CompletedJobs(
-                    completedJobs: Job.jobs
-                        .where((job) => job.status == JobStatus.completed)
-                        .toList(),
-                    onUpdate: () {
-                      setState(() {});
-                    },
-                  )
-                : _navIndex == 2
-                ? ActiveJobs(
-                    jobs: Job.jobs
-                        .where((job) => job.status != JobStatus.completed)
-                        .toList(),
-                    onUpdate: () {
-                      setState(() {});
-                    },
-                  )
-                : Container(),
+            ListFiles(
+              files: _getCurrentItems(),
+              keys: _keys,
+              sortMode: _listOptions.sortMode,
+              foldersFirst: _listOptions.foldersFirst,
+              gridView: _listOptions.viewMode == ViewMode.grid,
+              relativeto: _driveDir,
+              selection: _selection,
+              selectionAction: _selectionAction,
+              onUpdate: () {
+                setState(() {});
+              },
+              changeDirectory: _changeDirectory,
+              select: _select,
+              showContextMenu: (file) async {
+                await Main.stopWatchers();
+                await _showContextMenu(file);
+              },
+              buildContextMenu: _buildContextMenu,
+              count: _count,
+              dirSize: _dirSize,
+              dirModified: _dirModified,
+              getLink: _getLink,
+            ),
           ],
         ),
+
         floatingActionButton: Column(
           mainAxisSize: MainAxisSize.min,
           children: [
diff --git a/lib/media_view.dart b/lib/media_view.dart
index 62d45a2..412cfc2 100644
--- a/lib/media_view.dart
+++ b/lib/media_view.dart
@@ -1,8 +1,5 @@
 import 'dart:io';
-import 'dart:ui' as ui;
 import 'package:dio/dio.dart';
-import 'package:image/image.dart' as img;
-import 'package:flutter/foundation.dart';
 import 'package:flutter/material.dart';
 import 'package:flutter/services.dart';
 import 'package:pdfrx/pdfrx.dart';
@@ -333,8 +330,8 @@ class InteractiveMediaView extends StatefulWidget {
 
 class InteractiveMediaViewState extends State<InteractiveMediaView> {
   late MediaProvider _provider;
-  bool _loading = true;
-  double _progress = 0.0;
+  final bool _loading = true;
+  final double _progress = 0.0;
   double pdfscale = 1;
 
   final PhotoViewController _photoViewController = PhotoViewController();
@@ -768,8 +765,8 @@ class MediaPreview extends StatefulWidget {
 
 class MediaPreviewState extends State<MediaPreview> {
   late MyUrlMediaProvider _provider;
-  bool _isLoading = true;
-  double _progress = 0.0;
+  final bool _isLoading = true;
+  final double _progress = 0.0;
 
   // Future<void> _loadMedia() async {
   //   if (_provider is MemoryMediaProvider) {
diff --git a/lib/models.dart b/lib/models.dart
index 50d37bd..10e264e 100644
--- a/lib/models.dart
+++ b/lib/models.dart
@@ -40,11 +40,13 @@ class ListOptions {
   SortMode sortMode;
   ViewMode viewMode;
   bool foldersFirst;
+  bool group;
 
   ListOptions({
     this.sortMode = SortMode.nameAsc,
     this.viewMode = ViewMode.list,
     this.foldersFirst = true,
+    this.group = false,
   });
 
   factory ListOptions.fromJson(String json) {
@@ -55,6 +57,7 @@ class ListOptions {
       sortMode: SortMode.values[data['sortMode'] as int],
       viewMode: ViewMode.values[data['viewMode'] as int],
       foldersFirst: data['foldersFirst'] as bool,
+      group: data['group'] as bool,
     );
   }
 
@@ -63,6 +66,7 @@ class ListOptions {
       'sortMode': sortMode.index,
       'viewMode': viewMode.index,
       'foldersFirst': foldersFirst,
+      'group': group,
     });
   }
 }
diff --git a/lib/utils/context_menu.dart b/lib/utils/context_menu.dart
index 5b061ec..1fc6d61 100644
--- a/lib/utils/context_menu.dart
+++ b/lib/utils/context_menu.dart
@@ -49,7 +49,7 @@ class FileContextActionHandler extends ContextActionHandler {
   bool removable() {
     return !p.isDir(file.key) &&
         File(Main.pathFromKey(file.key) ?? file.key).existsSync() &&
-        Main.backupMode(file.key) == BackupMode.upload;
+        Main.backupModeFromKey(file.key) == BackupMode.upload;
   }
 
   dynamic Function()? open() {
@@ -182,7 +182,7 @@ class FilesContextActionHandler extends ContextActionHandler {
           (f) =>
               !p.isDir(f.key) &&
               File(Main.pathFromKey(f.key) ?? f.key).existsSync() &&
-              Main.backupMode(f.key) == BackupMode.upload,
+              Main.backupModeFromKey(f.key) == BackupMode.upload,
         )
         .toList();
   }
@@ -306,7 +306,7 @@ class DirectoryContextActionHandler extends ContextActionHandler {
               p.isWithin(file.key, f.key) &&
               !p.isDir(f.key) &&
               File(Main.pathFromKey(f.key) ?? f.key).existsSync() &&
-              Main.backupMode(f.key) == BackupMode.upload,
+              Main.backupModeFromKey(f.key) == BackupMode.upload,
         )
         .toList();
   }
@@ -440,7 +440,7 @@ class DirectoriesContextActionHandler extends ContextActionHandler {
               directories.any((dir) => p.isWithin(dir.key, f.key)) &&
               !p.isDir(f.key) &&
               File(Main.pathFromKey(f.key) ?? f.key).existsSync() &&
-              Main.backupMode(f.key) == BackupMode.upload,
+              Main.backupModeFromKey(f.key) == BackupMode.upload,
         )
         .toList();
   }
@@ -2406,7 +2406,7 @@ Widget buildDirectoryContextMenu(
                   title: const Text('Backup Mode'),
                 ),
                 RadioGroup(
-                  groupValue: Main.backupMode(file.key),
+                  groupValue: Main.backupModeFromKey(file.key),
                   onChanged: (s) {
                     setBackupMode(file.key, s!);
                     Navigator.of(context).pop();
diff --git a/lib/utils/job.dart b/lib/utils/job.dart
index c4ce7fa..65dd1cc 100644
--- a/lib/utils/job.dart
+++ b/lib/utils/job.dart
@@ -1,7 +1,8 @@
-import 'dart:convert';
 import 'dart:io';
 import 'dart:async';
+import 'dart:convert';
 import 'package:crypto/crypto.dart';
+import 'package:collection/collection.dart';
 import 'package:path_provider/path_provider.dart';
 import 'package:flutter/foundation.dart';
 import 'package:files3/utils/s3_transfer_task.dart';
@@ -13,20 +14,62 @@ import 'package:files3/helpers.dart';
 import 'package:files3/models.dart';
 
 abstract class Main {
-  static final Set<Profile> profiles = <Profile>{};
-  static final Map<String, Watcher> watcherMap = <String, Watcher>{};
-  static List<RemoteFile> remoteFiles = <RemoteFile>[];
-  static Function(bool loading)? setLoadingState;
-  static Function()? setHomeState;
-  static String downloadCacheDir = '';
-  static String documentsDir = '';
-  static final List<String> ignoreKeyRegexps = <String>[
+  static final Set<Profile> _profiles = <Profile>{};
+  static final Map<String, Watcher> _watcherMap = <String, Watcher>{};
+  static List<RemoteFile> _remoteFiles = <RemoteFile>[];
+  static Function(bool loading)? _setLoadingState;
+  static Function()? _setHomeState;
+  static Function()? _onRemoteFilesChanged;
+  static String _downloadCacheDir = '';
+  static String _documentsDir = '';
+  static final List<String> _ignoreKeyRegexps = <String>[
     r'^.*[/\\]deletion-register\.ini$',
   ];
 
+  static Set<Profile> get profiles => _profiles;
+
+  static List<RemoteFile> get remoteFiles => UnmodifiableListView(_remoteFiles);
+
+  static void remoteFilesAdd(RemoteFile file) {
+    _remoteFiles.add(file);
+    _ensureDirectoryObjects();
+    _onRemoteFilesChanged?.call();
+  }
+
+  static void remoteFilesAddAll(List<RemoteFile> files) {
+    _remoteFiles.addAll(files);
+    _ensureDirectoryObjects();
+    _onRemoteFilesChanged?.call();
+  }
+
+  static void remoteFilesRemoveWhere(bool Function(RemoteFile element) test) {
+    _remoteFiles.removeWhere(test);
+    _ensureDirectoryObjects();
+    _onRemoteFilesChanged?.call();
+  }
+
+  static set setLoadingState(Function(bool loading)? func) {
+    _setLoadingState = func;
+  }
+
+  static set setHomeState(Function()? func) {
+    setHomeState = func;
+  }
+
+  static set onRemoteFilesChanged(Function()? func) {
+    _onRemoteFilesChanged = func;
+  }
+
+  static String get downloadCacheDir => _downloadCacheDir;
+
+  static String get documentsDir => _documentsDir;
+
+  static List<String> get ignoreKeyRegexps =>
+      UnmodifiableListView(_ignoreKeyRegexps);
+
   static Profile? profileFromKey(String key) {
     try {
-      return profiles.firstWhere(
+      return _profiles.firstWhere(
         (profile) => profile.name == p.split(key).firstOrNull,
       );
     } catch (e) {
@@ -65,51 +108,51 @@ abstract class Main {
 
   static Watcher? watcherFromKey(String key) {
     final dirKey = p.s3(p.asDir(p.split(key).firstOrNull ?? ''));
-    return watcherMap[dirKey];
+    return _watcherMap[dirKey];
   }
 
   static String cachePathFromKey(String key) {
     return p.join(
-      Main.downloadCacheDir,
+      _downloadCacheDir,
       'app_${sha1.convert(utf8.encode(key)).toString()}.tmp',
     );
   }
 
   static String tagPathFromKey(String key) {
     return p.join(
-      Main.downloadCacheDir,
+      _downloadCacheDir,
       'app_${sha1.convert(utf8.encode(key)).toString()}.tag',
     );
   }
 
+  static BackupMode backupModeFromKey(String key) {
+    String? value = IniManager.config?.get('modes', key);
+    if (value == null && p.split(key).length > 1) {
+      return backupModeFromKey(p.s3(p.dirname(key)));
+    } else {
+      return BackupMode.fromValue(int.parse(value ?? '1'));
+    }
+  }
+
   static Future<void> onJobStatus(Job job, dynamic result) async {
     if (job is UploadJob &&
         job.status == JobStatus.completed &&
         result is RemoteFile) {
-      remoteFiles.removeWhere((file) => file.key == job.remoteKey);
-      remoteFiles.add(result);
+      _remoteFiles.removeWhere((file) => file.key == job.remoteKey);
+      _remoteFiles.add(result);
     }
-    setHomeState?.call();
+    _setHomeState?.call();
   }
 
   static Future<void> stopWatchers() async {
     if (kDebugMode) {
       debugPrint("Stopping all watchers...");
     }
-    for (final watcher in watcherMap.values.toList()) {
+    for (final watcher in _watcherMap.values.toList()) {
       await watcher.stop();
     }
   }
 
-  static BackupMode backupMode(String key) {
-    String? value = IniManager.config?.get('modes', key);
-    if (value == null && p.split(key).length > 1) {
-      return backupMode(p.s3(p.dirname(key)));
-    } else {
-      return BackupMode.fromValue(int.parse(value ?? '1'));
-    }
-  }
-
   static Future<void> addWatcher(String dir, {bool background = false}) async {
     final localDir = Main.pathFromKey(dir);
 
@@ -118,7 +161,7 @@ abstract class Main {
         Directory(localDir).existsSync()) {
       Watcher watcher = Watcher(remoteDir: dir);
 
-      watcherMap[dir] = watcher;
+      _watcherMap[dir] = watcher;
       if (background) {
         if (kDebugMode) {
           debugPrint("Performing background scan for $localDir");
@@ -133,10 +176,10 @@ abstract class Main {
     }
   }
 
-  static void ensureDirectoryObjects() {
-    final existingPaths = remoteFiles.map((o) => o.key).toSet();
+  static void _ensureDirectoryObjects() {
+    final existingPaths = _remoteFiles.map((o) => o.key).toSet();
 
-    for (final obj in remoteFiles.toList()) {
+    for (final obj in _remoteFiles.toList()) {
       final normalized = p.normalize(obj.key);
       final isDir = p.isDir(normalized);
 
@@ -163,7 +206,7 @@ abstract class Main {
             lastModified: DateTime.now(),
           );
 
-          remoteFiles.add(dirObject);
+          _remoteFiles.add(dirObject);
           existingPaths.add(dirPath);
         }
       }
@@ -171,11 +214,11 @@ abstract class Main {
   }
 
   static Future<void> refreshWatchers({bool background = false}) async {
-    setLoadingState?.call(true);
+    _setLoadingState?.call(true);
     await stopWatchers();
-    watcherMap.clear();
+    _watcherMap.clear();
 
-    final dirs = remoteFiles
+    final dirs = _remoteFiles
         .where((dir) => p.isDir(dir.key))
         .map((file) => p.s3(p.asDir(p.split(file.key).firstOrNull ?? '')))
         .toSet()
@@ -184,40 +227,39 @@ abstract class Main {
     for (final dir in dirs) {
       await addWatcher(dir, background: background);
     }
-    setLoadingState?.call(false);
+    _setLoadingState?.call(false);
   }
 
   static Future<void> refreshProfiles() async {
-    setLoadingState?.call(true);
+    _setLoadingState?.call(true);
     for (final entry in (await ConfigManager.loadS3Config()).entries) {
-      if (profiles.any((profile) => profile.name == entry.key)) {
-        profiles
+      if (_profiles.any((profile) => profile.name == entry.key)) {
+        _profiles
             .firstWhere((profile) => profile.name == entry.key)
             .updateConfig(entry.value);
         continue;
       }
-      profiles.add(Profile(name: entry.key, cfg: entry.value));
+      _profiles.add(Profile(name: entry.key, cfg: entry.value));
     }
-    setLoadingState?.call(false);
+    _setLoadingState?.call(false);
   }
 
   static Future<void> listDirectories({bool background = false}) async {
-    setLoadingState?.call(true);
-
+    _setLoadingState?.call(true);
     if (!background) {
-      Main.remoteFiles = (await ConfigManager.loadRemoteFiles())
+      _remoteFiles = (await ConfigManager.loadRemoteFiles())
           .where(
-            (file) => profiles.any(
+            (file) => _profiles.any(
               (profile) => profile.name == p.split(file.key).firstOrNull,
             ),
           )
           .toList();
     }
 
-    for (final profile in profiles) {
+    for (final profile in _profiles) {
       await profile.listDirectories(background: background);
     }
-    setLoadingState?.call(false);
+    _setLoadingState?.call(false);
   }
 
   static void downloadFile(RemoteFile file, {String? localPath}) {
@@ -277,7 +319,7 @@ abstract class Main {
         String ext = p.extension(key);
         int count = 1;
         String candidateKey = key;
-        while (remoteFiles.any(
+        while (_remoteFiles.any(
               (remoteFile) => remoteFile.key == candidateKey,
             ) ==
             true) {
@@ -302,7 +344,7 @@ abstract class Main {
         String ext = p.extension(key);
         int count = 1;
         String candidateKey = key;
-        while (remoteFiles.any(
+        while (_remoteFiles.any(
               (remoteFile) => remoteFile.key == candidateKey,
             ) ==
             true) {
@@ -323,21 +365,21 @@ abstract class Main {
   }
 
   static Future<void> init({bool background = false}) async {
-    if (downloadCacheDir.isEmpty) {
+    if (_downloadCacheDir.isEmpty) {
       final directory = await getApplicationCacheDirectory();
-      downloadCacheDir = p.join(directory.path, 'Downloads');
+      _downloadCacheDir = p.join(directory.path, 'Downloads');
     }
-    if (documentsDir.isEmpty) {
+    if (_documentsDir.isEmpty) {
       final directory = await getApplicationDocumentsDirectory();
-      documentsDir = directory.path;
+      _documentsDir = directory.path;
     }
     if (!ConfigManager.initialized) {
       await ConfigManager.init();
     }
-    Profile.setLoadingState = setLoadingState;
+    Profile.setLoadingState = _setLoadingState;
     Job.maxrun = ConfigManager.loadTransferConfig().maxConcurrentTransfers;
     Job.onProgressUpdate = () {
-      setHomeState?.call();
+      _setHomeState?.call();
     };
     refreshProfiles().then((_) {
       listDirectories(background: background);
@@ -739,7 +781,9 @@ class Watcher {
           Main.ignoreKeyRegexps.any((regexp) => RegExp(regexp).hasMatch(key))) {
         continue;
       }
-      BackupMode mode = Main.backupMode(Main.keyFromPath(file.path) ?? '');
+      BackupMode mode = Main.backupModeFromKey(
+        Main.keyFromPath(file.path) ?? '',
+      );
       if (mode == BackupMode.sync || mode == BackupMode.upload) {
         Main.uploadFile(key, file);
       }
@@ -755,7 +799,7 @@ class Watcher {
           )) {
         continue;
       }
-      BackupMode mode = Main.backupMode(file.key);
+      BackupMode mode = Main.backupModeFromKey(file.key);
       if (mode == BackupMode.sync || mode == BackupMode.upload) {
         Main.downloadFile(file);
       }
@@ -771,7 +815,7 @@ class Watcher {
           )) {
         continue;
       }
-      if (Main.backupMode(file.key) == BackupMode.sync) {
+      if (Main.backupModeFromKey(file.key) == BackupMode.sync) {
         Main.downloadFile(file);
       }
     }
diff --git a/lib/utils/profile.dart b/lib/utils/profile.dart
index 040bd04..60ee7ca 100644
--- a/lib/utils/profile.dart
+++ b/lib/utils/profile.dart
@@ -37,11 +37,10 @@ class Profile {
   Future<void> refreshRemote({required String dir}) async {
     try {
       final fetchedRemoteFiles = await fileManager!.listObjects(dir);
-      Main.remoteFiles.removeWhere(
+      Main.remoteFilesRemoveWhere(
         (file) => p.isWithin(dir, file.key) || file.key == dir || dir.isEmpty,
       );
-      Main.remoteFiles.addAll(fetchedRemoteFiles);
-      Main.ensureDirectoryObjects();
+      Main.remoteFilesAddAll(fetchedRemoteFiles);
       await ConfigManager.saveRemoteFiles(Main.remoteFiles);
       accessible = true;
     } catch (e) {
